<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title></title>
<style type="text/css">
/**
 * Prism.s theme ported from highlight.js's xcode style
 */
pre code {
  padding: 1em;
}
.token.comment {
  color: #007400;
}
.token.punctuation {
  color: #999;
}
.token.tag,
.token.selector {
  color: #aa0d91;
}
.token.boolean,
.token.number,
.token.constant,
.token.symbol {
  color: #1c00cf;
}
.token.property,
.token.attr-name,
.token.string,
.token.char,
.token.builtin {
  color: #c41a16;
}
.token.inserted {
  background-color: #ccffd8;
}
.token.deleted {
  background-color: #ffebe9;
}
.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
  color: #9a6e3a;
}
.token.atrule,
.token.attr-value,
.token.keyword {
  color: #836c28;
}
.token.function,
.token.class-name {
  color: #DD4A68;
}
.token.regex,
.token.important,
.token.variable {
  color: #5c2699;
}
.token.important,
.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}
</style>
<style type="text/css">
body {
  font-family: sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 1.5;
  box-sizing: border-box;
}
body, .footnotes, code { font-size: .9em; }
li li { font-size: .95em; }
*, *:before, *:after {
  box-sizing: inherit;
}
pre, img { max-width: 100%; }
pre, pre:hover {
  white-space: pre-wrap;
  word-break: break-all;
}
pre code {
  display: block;
  overflow-x: auto;
}
code { font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace; }
:not(pre) > code, code[class] { background-color: #F8F8F8; }
code.language-undefined, pre > code:not([class]) {
  background-color: inherit;
  border: 1px solid #eee;
}
table {
  margin: auto;
  border-top: 1px solid #666;
}
table thead th { border-bottom: 1px solid #ddd; }
th, td { padding: 5px; }
thead, tfoot, tr:nth-child(even) { background: #eee; }
blockquote {
  color: #666;
  margin: 0;
  padding-left: 1em;
  border-left: 0.5em solid #eee;
}
hr, .footnotes::before { border: 1px dashed #ddd; }
.frontmatter { text-align: center; }
#TOC .numbered li { list-style: none; }
#TOC .numbered { padding-left: 0; }
#TOC .numbered ul { padding-left: 1em; }
table, .body h2 { border-bottom: 1px solid #666; }
.body .appendix, .appendix ~ h2 { border-bottom-style: dashed; }
.footnote-ref a::before { content: "["; }
.footnote-ref a::after { content: "]"; }
section.footnotes::before {
  content: "";
  display: block;
  max-width: 20em;
}

@media print {
  body {
    font-size: 12pt;
    max-width: 100%;
  }
  tr, img { page-break-inside: avoid; }
}
@media only screen and (min-width: 992px) {
  pre { white-space: pre; }
}
</style>
</head>
<body>
<div class="frontmatter">
<div class="title"><h1></h1></div>
<div class="author"><h2></h2></div>
<div class="date"><h3></h3></div>
</div>
<div class="body">
<pre><code class="language-r"># Load Library
library(tidymodels)
library(tidyverse)

# Import dataset
titanic_test &lt;- read_csv(&quot;test.csv&quot;)
</code></pre>
<pre><code>## Rows: 418 Columns: 11
## ── Column specification ───────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): Name, Sex, Ticket, Cabin, Embarked
## dbl (6): PassengerId, Pclass, Age, SibSp, Parch, Fare
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
</code></pre>
<pre><code class="language-r">titanic_train &lt;- read_csv(&quot;train.csv&quot;)
</code></pre>
<pre><code>## Rows: 891 Columns: 12
## ── Column specification ───────────────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): Name, Sex, Ticket, Cabin, Embarked
## dbl (7): PassengerId, Survived, Pclass, Age, SibSp, Parch, Fare
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
</code></pre>
<pre><code class="language-r">titanic_train |&gt; summarise_all(~ sum(is.na(.)))
</code></pre>
<pre><code>## # A tibble: 1 × 12
##   PassengerId Survived Pclass  Name   Sex   Age SibSp Parch Ticket  Fare Cabin Embarked
##         &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;
## 1           0        0      0     0     0   177     0     0      0     0   687        2
</code></pre>
<pre><code class="language-r">titanic_test |&gt; summarise_all(~ sum(is.na(.)))
</code></pre>
<pre><code>## # A tibble: 1 × 11
##   PassengerId Pclass  Name   Sex   Age SibSp Parch Ticket  Fare Cabin Embarked
##         &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;
## 1           0      0     0     0    86     0     0      0     1   327        0
</code></pre>
<pre><code class="language-r">titanic_full &lt;- bind_rows(titanic_train, titanic_test)

titanic_full |&gt; summarise_all(~ sum(is.na(.)))
</code></pre>
<pre><code>## # A tibble: 1 × 12
##   PassengerId Survived Pclass  Name   Sex   Age SibSp Parch Ticket  Fare Cabin Embarked
##         &lt;int&gt;    &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;
## 1           0      418      0     0     0   263     0     0      0     1  1014        2
</code></pre>
<pre><code class="language-r">glimpse(titanic_full)
</code></pre>
<pre><code>## Rows: 1,309
## Columns: 12
## $ PassengerId &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20…
## $ Survived    &lt;dbl&gt; 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, …
## $ Pclass      &lt;dbl&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3, 2, 3, 3, 2, 2, 3, …
## $ Name        &lt;chr&gt; &quot;Braund, Mr. Owen Harris&quot;, &quot;Cumings, Mrs. John Bradley (Florence Brig…
## $ Sex         &lt;chr&gt; &quot;male&quot;, &quot;female&quot;, &quot;female&quot;, &quot;female&quot;, &quot;male&quot;, &quot;male&quot;, &quot;male&quot;, &quot;male&quot;,…
## $ Age         &lt;dbl&gt; 22, 38, 26, 35, 35, NA, 54, 2, 27, 14, 4, 58, 20, 39, 14, 55, 2, NA, …
## $ SibSp       &lt;dbl&gt; 1, 1, 0, 1, 0, 0, 0, 3, 0, 1, 1, 0, 0, 1, 0, 0, 4, 0, 1, 0, 0, 0, 0, …
## $ Parch       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 1, 0, 0, 5, 0, 0, 1, 0, 0, 0, 0, 0, 0, …
## $ Ticket      &lt;chr&gt; &quot;A/5 21171&quot;, &quot;PC 17599&quot;, &quot;STON/O2. 3101282&quot;, &quot;113803&quot;, &quot;373450&quot;, &quot;330…
## $ Fare        &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, 51.8625, 21.0750, 1…
## $ Cabin       &lt;chr&gt; NA, &quot;C85&quot;, NA, &quot;C123&quot;, NA, NA, &quot;E46&quot;, NA, NA, NA, &quot;G6&quot;, &quot;C103&quot;, NA, N…
## $ Embarked    &lt;chr&gt; &quot;S&quot;, &quot;C&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;Q&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;C&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;, &quot;S&quot;,…
</code></pre>
<pre><code class="language-r">str(titanic_full)
</code></pre>
<pre><code>## spc_tbl_ [1,309 × 12] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##  $ PassengerId: num [1:1309] 1 2 3 4 5 6 7 8 9 10 ...
##  $ Survived   : num [1:1309] 0 1 1 1 0 0 0 0 1 1 ...
##  $ Pclass     : num [1:1309] 3 1 3 1 3 3 1 3 3 2 ...
##  $ Name       : chr [1:1309] &quot;Braund, Mr. Owen Harris&quot; &quot;Cumings, Mrs. John Bradley (Florence Briggs Thayer)&quot; &quot;Heikkinen, Miss. Laina&quot; &quot;Futrelle, Mrs. Jacques Heath (Lily May Peel)&quot; ...
##  $ Sex        : chr [1:1309] &quot;male&quot; &quot;female&quot; &quot;female&quot; &quot;female&quot; ...
##  $ Age        : num [1:1309] 22 38 26 35 35 NA 54 2 27 14 ...
##  $ SibSp      : num [1:1309] 1 1 0 1 0 0 0 3 0 1 ...
##  $ Parch      : num [1:1309] 0 0 0 0 0 0 0 1 2 0 ...
##  $ Ticket     : chr [1:1309] &quot;A/5 21171&quot; &quot;PC 17599&quot; &quot;STON/O2. 3101282&quot; &quot;113803&quot; ...
##  $ Fare       : num [1:1309] 7.25 71.28 7.92 53.1 8.05 ...
##  $ Cabin      : chr [1:1309] NA &quot;C85&quot; NA &quot;C123&quot; ...
##  $ Embarked   : chr [1:1309] &quot;S&quot; &quot;C&quot; &quot;S&quot; &quot;S&quot; ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   PassengerId = col_double(),
##   ..   Survived = col_double(),
##   ..   Pclass = col_double(),
##   ..   Name = col_character(),
##   ..   Sex = col_character(),
##   ..   Age = col_double(),
##   ..   SibSp = col_double(),
##   ..   Parch = col_double(),
##   ..   Ticket = col_character(),
##   ..   Fare = col_double(),
##   ..   Cabin = col_character(),
##   ..   Embarked = col_character()
##   .. )
##  - attr(*, &quot;problems&quot;)=&lt;externalptr&gt;
</code></pre>
<pre><code class="language-r"># Data transformation
titanic_full &lt;- titanic_full |&gt;
  mutate(FamilySize = SibSp + Parch + 1) |&gt;
  select(-SibSp, -Parch)

titanic_full$title &lt;- titanic_full$Name |&gt;
  str_extract(&quot;([A-z]+)\\.&quot;) |&gt;
  str_sub(end = -2)
titanic_full |&gt;
  group_by(title) |&gt;
  count() |&gt;
  arrange(desc(n)) |&gt;
  ungroup() |&gt;
  mutate(prop = n / sum(n))
</code></pre>
<pre><code>## # A tibble: 18 × 3
##    title        n     prop
##    &lt;chr&gt;    &lt;int&gt;    &lt;dbl&gt;
##  1 Mr         757 0.578   
##  2 Miss       260 0.199   
##  3 Mrs        197 0.150   
##  4 Master      61 0.0466  
##  5 Dr           8 0.00611 
##  6 Rev          8 0.00611 
##  7 Col          4 0.00306 
##  8 Major        2 0.00153 
##  9 Mlle         2 0.00153 
## 10 Ms           2 0.00153 
## 11 Capt         1 0.000764
## 12 Countess     1 0.000764
## 13 Don          1 0.000764
## 14 Dona         1 0.000764
## 15 Jonkheer     1 0.000764
## 16 Lady         1 0.000764
## 17 Mme          1 0.000764
## 18 Sir          1 0.000764
</code></pre>
<pre><code class="language-r">titanic_full &lt;- titanic_full |&gt; select(-Cabin, -Ticket, -Name)

titanic_full &lt;- titanic_full |&gt; mutate(across(c(Survived, Pclass, Sex, Embarked, title), as.factor))

# input missing data
impute_data &lt;- recipe(Survived ~ ., data = titanic_full) |&gt;
  step_impute_mode(Embarked) |&gt;
  step_impute_linear(Fare) |&gt;
  step_impute_knn(Age) |&gt;
  prep()

imputed &lt;- bake(impute_data, new_data = titanic_full)

imputed |&gt; summarise_all(~ sum(is.na(.)))
</code></pre>
<pre><code>## # A tibble: 1 × 9
##   PassengerId Pclass   Sex   Age  Fare Embarked FamilySize title Survived
##         &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;      &lt;int&gt; &lt;int&gt;    &lt;int&gt;
## 1           0      0     0     0     0        0          0     0      418
</code></pre>
<pre><code class="language-r">imputed &lt;- imputed |&gt; mutate(Age = case_when(
  Age &lt; 8 ~ &quot;anak-anak&quot;,
  Age &gt;= 9 &amp; Age &lt; 19 ~ &quot;remaja&quot;,
  Age &gt;= 19 &amp; Age &lt;= 60 ~ &quot;dewasa&quot;,
  TRUE ~ &quot;lansia&quot;
))

imputed$Age &lt;- as.factor(imputed$Age)

glimpse(imputed)
</code></pre>
<pre><code>## Rows: 1,309
## Columns: 9
## $ PassengerId &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20…
## $ Pclass      &lt;fct&gt; 3, 1, 3, 1, 3, 3, 1, 3, 3, 2, 3, 1, 3, 3, 3, 2, 3, 2, 3, 3, 2, 2, 3, …
## $ Sex         &lt;fct&gt; male, female, female, female, male, male, male, male, female, female,…
## $ Age         &lt;fct&gt; dewasa, dewasa, dewasa, dewasa, dewasa, dewasa, dewasa, anak-anak, de…
## $ Fare        &lt;dbl&gt; 7.2500, 71.2833, 7.9250, 53.1000, 8.0500, 8.4583, 51.8625, 21.0750, 1…
## $ Embarked    &lt;fct&gt; S, C, S, S, S, Q, S, S, S, C, S, S, S, S, S, S, Q, S, S, C, S, S, Q, …
## $ FamilySize  &lt;dbl&gt; 2, 2, 1, 2, 1, 1, 1, 5, 3, 2, 3, 1, 1, 7, 1, 1, 6, 1, 2, 1, 1, 1, 1, …
## $ title       &lt;fct&gt; Mr, Mrs, Miss, Mrs, Mr, Mr, Mr, Master, Mrs, Mrs, Miss, Miss, Mr, Mr,…
## $ Survived    &lt;fct&gt; 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, …
</code></pre>
<pre><code class="language-r"># build a model
titanic_train &lt;- imputed |&gt; slice(1:891)
titanic_test &lt;- imputed |&gt; slice(892:1309)

imputed |&gt; view()

set.seed(777)
split &lt;- initial_split(titanic_train, prop = 0.8, strata = Survived)
train &lt;- training(split)
test &lt;- testing(split)

titanic_recipe &lt;- recipe(data = train, formula = Survived ~ .) |&gt; 
  update_role(PassengerId, new_role = &quot;id&quot;) |&gt;
  step_normalize(all_numeric_predictors()) |&gt;
  step_other(title, threshold = 0.02) |&gt;
  step_dummy(all_nominal_predictors()) 
  
titanic_prep &lt;- prep(titanic_recipe)

bake(titanic_prep, new_data = NULL)
</code></pre>
<pre><code>## # A tibble: 712 × 16
##    PassengerId     Fare FamilySize Survived Pclass_X2 Pclass_X3 Sex_male Age_dewasa
##          &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;fct&gt;        &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
##  1           5 -0.510       -0.566 0                0         1        1          1
##  2           7  0.454       -0.566 0                0         0        1          1
##  3           8 -0.223        1.86  0                0         1        1          0
##  4          13 -0.510       -0.566 0                0         1        1          1
##  5          14  0.00120      3.07  0                0         1        1          1
##  6          15 -0.514       -0.566 0                0         1        0          0
##  7          17 -0.0461       2.46  0                0         1        1          0
##  8          25 -0.223        1.86  0                0         1        0          0
##  9          27 -0.528       -0.566 0                0         1        1          1
## 10          28  5.10         2.46  0                0         0        1          1
## # ℹ 702 more rows
## # ℹ 8 more variables: Age_lansia &lt;dbl&gt;, Age_remaja &lt;dbl&gt;, Embarked_Q &lt;dbl&gt;,
## #   Embarked_S &lt;dbl&gt;, title_Miss &lt;dbl&gt;, title_Mr &lt;dbl&gt;, title_Mrs &lt;dbl&gt;, title_other &lt;dbl&gt;
</code></pre>
<pre><code class="language-r">set.seed(345)
folds &lt;- vfold_cv(train, v = 10, repeats = 1, strata = Survived)

rf_spec &lt;- rand_forest(mtry = tune(), min_n = tune(), trees = 1000) |&gt; 
  set_engine(&quot;ranger&quot;) |&gt;
  set_mode(&quot;classification&quot;)

titanic_workflow &lt;- workflow() |&gt;
  add_recipe(titanic_recipe) |&gt;
  add_model(rf_spec)

rf_tune &lt;- tune_grid(titanic_workflow,
  resamples = folds,
  grid = 10, 
  control = control_grid(save_pred = TRUE, parallel_over = &quot;everything&quot;)
)
</code></pre>
<pre><code>## i Creating pre-processing data to finalize unknown parameter: mtry
</code></pre>
<pre><code class="language-r"># evaluate model
collect_metrics(rf_tune)
</code></pre>
<pre><code>## # A tibble: 30 × 8
##     mtry min_n .metric     .estimator  mean     n std_err .config              
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
##  1    11     9 accuracy    binary     0.834    10 0.0163  Preprocessor1_Model01
##  2    11     9 brier_class binary     0.128    10 0.0103  Preprocessor1_Model01
##  3    11     9 roc_auc     binary     0.875    10 0.0165  Preprocessor1_Model01
##  4     9    25 accuracy    binary     0.834    10 0.0159  Preprocessor1_Model02
##  5     9    25 brier_class binary     0.126    10 0.00956 Preprocessor1_Model02
##  6     9    25 roc_auc     binary     0.872    10 0.0168  Preprocessor1_Model02
##  7    13    31 accuracy    binary     0.833    10 0.0171  Preprocessor1_Model03
##  8    13    31 brier_class binary     0.128    10 0.00975 Preprocessor1_Model03
##  9    13    31 roc_auc     binary     0.871    10 0.0161  Preprocessor1_Model03
## 10     6    13 accuracy    binary     0.844    10 0.0165  Preprocessor1_Model04
## # ℹ 20 more rows
</code></pre>
<pre><code class="language-r">show_best(rf_tune, metric = &quot;accuracy&quot;)
</code></pre>
<pre><code>## # A tibble: 5 × 8
##    mtry min_n .metric  .estimator  mean     n std_err .config              
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1     6    13 accuracy binary     0.844    10  0.0165 Preprocessor1_Model04
## 2     6    37 accuracy binary     0.838    10  0.0162 Preprocessor1_Model08
## 3    13    35 accuracy binary     0.837    10  0.0162 Preprocessor1_Model09
## 4     8    25 accuracy binary     0.836    10  0.0164 Preprocessor1_Model07
## 5     9    25 accuracy binary     0.834    10  0.0159 Preprocessor1_Model02
</code></pre>
<pre><code class="language-r">final_rf &lt;- titanic_workflow |&gt;
  finalize_workflow(select_best(rf_tune, metric = &quot;accuracy&quot;))

final_fit &lt;- final_rf |&gt;
  last_fit(split)

collect_metrics(final_fit)
</code></pre>
<pre><code>## # A tibble: 3 × 4
##   .metric     .estimator .estimate .config             
##   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy    binary         0.849 Preprocessor1_Model1
## 2 roc_auc     binary         0.884 Preprocessor1_Model1
## 3 brier_class binary         0.116 Preprocessor1_Model1
</code></pre>
<pre><code class="language-r">final_model &lt;- extract_workflow(final_fit)

pred &lt;- final_model |&gt; predict(titanic_test)
pred
</code></pre>
<pre><code>## # A tibble: 418 × 1
##    .pred_class
##    &lt;fct&gt;      
##  1 0          
##  2 1          
##  3 0          
##  4 0          
##  5 1          
##  6 0          
##  7 1          
##  8 0          
##  9 1          
## 10 0          
## # ℹ 408 more rows
</code></pre>
<pre><code class="language-r">prediksi &lt;- titanic_test |&gt;
  select(PassengerId) |&gt;
  bind_cols(pred) |&gt;
  rename(Survived = .pred_class)

write_csv(prediksi, file = &quot;predict.csv&quot;)
</code></pre>
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
</body>
</html>
